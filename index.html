<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<title>Търсене на верига за резачка</title>
<style>
body {
  font-family: Arial, sans-serif;
  max-width: 700px;
  margin: 30px auto;
}
select, input {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
}
.section {
  margin-bottom: 30px;
}
.result {
  background: #f3f3f3;
  padding: 15px;
  margin-top: 15px;
}
li {
  margin-bottom: 8px;
}
</style>
</head>
<body>

<h2>Търсене на верига за резачка</h2>

<div class="section">
  <h3>Търсене по 6-цифрен код</h3>
  <input id="codeInput" type="text" placeholder="Въведете код (напр. 123456)">
  <div class="result" id="codeResult"></div>
</div>

<hr>

<div class="section">
  <h3>Търсене по тип резачка</h3>
  <select id="typeSelect">
    <option value="">Изберете вид</option>
  </select>
  <select id="brandSelect" disabled>
    <option value="">Изберете марка</option>
  </select>
  <select id="modelSelect" disabled>
    <option value="">Изберете модел</option>
  </select>
  <div class="result" id="stepResult"></div>
</div>

<script>
// PASTE your CSV Publish URL here
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ10nkDvscxOamJps57hzc-EkAjz3-7vsifyiTNsXRVvTyrqTYfEorg8f2EkkEIon9IzmD_9rf4Hi1t/pub?output=csv";

let data = [];

fetch(CSV_URL)
  .then(res => res.text())
  .then(text => {
    const rows = text.trim().split("\n").slice(1); // skip headers
    data = rows.map(r => {
      const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
      return {
        code: c[0].trim(),   // Код
        brand: c[1].trim(),  // Марка
        model: c[2].trim(),  // Модел
        chain: c[3].replace(/"/g, "").trim(), // Верига
        type: c[4].trim()    // Вид
      };
    });
    populateTypes();
  });

// DOM elements
const typeSelect = document.getElementById("typeSelect");
const brandSelect = document.getElementById("brandSelect");
const modelSelect = document.getElementById("modelSelect");
const stepResult = document.getElementById("stepResult");
const codeInput = document.getElementById("codeInput");
const codeResult = document.getElementById("codeResult");

/* ---------- TYPE → BRAND → MODEL ---------- */

function populateTypes() {
  const types = [...new Set(data.map(d => d.type))];
  types.forEach(t => {
    const o = document.createElement("option");
    o.value = t;
    o.textContent = t;
    typeSelect.appendChild(o);
  });
}

typeSelect.addEventListener("change", () => {
  brandSelect.innerHTML = '<option value="">Изберете марка</option>';
  modelSelect.innerHTML = '<option value="">Изберете модел</option>';
  brandSelect.disabled = false;
  modelSelect.disabled = true;
  stepResult.innerHTML = "";

  const brands = data.filter(d => d.type === typeSelect.value).map(d => d.brand);
  addOptions(brandSelect, brands);
});

brandSelect.addEventListener("change", () => {
  modelSelect.innerHTML = '<option value="">Изберете модел</option>';
  modelSelect.disabled = false;
  stepResult.innerHTML = "";

  const models = data
    .filter(d => d.type === typeSelect.value && d.brand === brandSelect.value)
    .map(d => d.model);
  addOptions(modelSelect, models);
});

modelSelect.addEventListener("change", () => {
  const matches = data.filter(d =>
    d.type === typeSelect.value &&
    d.brand === brandSelect.value &&
    d.model === modelSelect.value
  );
  stepResult.innerHTML = `
    <strong>Подходяща верига:</strong>
    <ul>
      ${matches.map(m => `<li><strong>Код:</strong> ${m.code}<br><strong>Верига:</strong> ${m.chain}</li>`).join("")}
    </ul>
  `;
});

/* ---------- SEARCH BY CODE ---------- */

codeInput.addEventListener("input", () => {
  const code = codeInput.value.trim();
  if (code.length !== 6) { codeResult.innerHTML = ""; return; }

  const match = data.find(d => d.code === code);
  if (!match) {
    codeResult.innerHTML = "Няма намерен резултат.";
    return;
  }

  codeResult.innerHTML = `
    <strong>Резултат:</strong><br>
    <strong>Марка:</strong> ${match.brand}<br>
    <strong>Модел:</strong> ${match.model}<br>
    <strong>Вид:</strong> ${match.type}<br>
    <strong>Верига:</strong> ${match.chain}
  `;
});

/* ---------- Helper ---------- */
function addOptions(select, values) {
  [...new Set(values)].forEach(v => {
    const o = document.createElement("option");
    o.value = v;
    o.textContent = v;
    select.appendChild(o);
  });
}
</script>

</body>
</html>
