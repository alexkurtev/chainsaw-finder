<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<title>Търсене на верига за резачка</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  font-family: Arial, sans-serif;
  max-width: 700px;
  margin: 20px auto;
  padding: 0 15px;
  background: #f9f9f9;
}
h2, h3 { text-align: center; color: #333; }
select, input {
  width: 100%;
  padding: 14px;
  margin-top: 10px;
  font-size: 16px;
  border: 1px solid #ccc;
  border-radius: 8px;
  box-sizing: border-box;
  transition: 0.2s;
}
select:focus, input:focus {
  border-color: #007BFF;
  box-shadow: 0 0 5px rgba(0,123,255,0.3);
  outline: none;
}
.section { margin-bottom: 30px; }
.result { margin-top: 15px; }
.card {
  background: #fff;
  border-radius: 10px;
  padding: 15px;
  margin-bottom: 12px;
  box-shadow: 0 3px 6px rgba(0,0,0,0.1);
}
.card strong { color: #007BFF; }
hr { border: none; border-top: 1px solid #ccc; margin: 30px 0; }
@media screen and (max-width: 480px) {
  body { margin: 10px; }
  select, input { font-size: 18px; padding: 16px; }
  .card { padding: 18px; font-size: 16px; }
}
</style>
</head>
<body>

<h2>Търсене на верига за резачка</h2>

<div class="section">
  <h3>Търсене по 6-цифрен код</h3>
  <input id="codeInput" type="text" placeholder="Въведете код (напр. 123456)">
  <div class="result" id="codeResult"></div>
</div>

<hr>

<div class="section">
  <h3>Търсене по тип резачка</h3>
  <select id="typeSelect">
    <option value="">Изберете вид</option>
  </select>
  <select id="brandSelect" disabled>
    <option value="">Изберете марка</option>
  </select>
  <select id="modelSelect" disabled>
    <option value="">Изберете модел</option>
  </select>
  <div class="result" id="stepResult"></div>
</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2pacx-1vq10nkdvscxoamjps57hzc-ekajz3-7vsifyitnsxrvvtyrqtyfeorg8f2ekkeion9izmd_9rf4hi1t/pub?output=csv";

let data = [];

fetch(CSV_URL)
  .then(res => res.text())
  .then(text => {
    const rows = text.trim().split("\n");
    // Skip the first row because it's the header
    data = rows.slice(1).map(r => {
      const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
      return {
        code: c[0].trim(),   // Код
        brand: c[1].trim(),  // Марка
        model: c[2].trim(),  // Модел
        chain: c[3].replace(/"/g, "").trim(), // Верига
        type: c[4].trim()    // Вид
      };
    });
    populateTypes();
  });

// DOM
const typeSelect = document.getElementById("typeSelect");
const brandSelect = document.getElementById("brandSelect");
const modelSelect = document.getElementById("modelSelect");
const stepResult = document.getElementById("stepResult");
const codeInput = document.getElementById("codeInput");
const codeResult = document.getElementById("codeResult");

function populateTypes() {
  const types = [...new Set(data.map(d => d.type))];
  types.forEach(t => {
    const o = document.createElement("option");
    o.value = t;
    o.textContent = t;
    typeSelect.appendChild(o);
  });
}

typeSelect.addEventListener("change", () => {
  brandSelect.innerHTML = '<option value="">Изберете марка</option>';
  modelSelect.innerHTML = '<option value="">Изберете модел</option>';
  brandSelect.disabled = false;
  modelSelect.disabled = true;
  stepResult.innerHTML = "";
  const brands = data.filter(d => d.type === typeSelect.value).map(d => d.brand);
  addOptions(brandSelect, brands);
});

brandSelect.addEventListener("change", () => {
  modelSelect.innerHTML = '<option value="">Изберете модел</option>';
  modelSelect.disabled = false;
  stepResult.innerHTML = "";
  const models = data.filter(d => d.type === typeSelect.value && d.brand === brandSelect.value).map(d => d.model);
  addOptions(modelSelect, models);
});

modelSelect.addEventListener("change", () => {
  const matches = data.filter(d =>
    d.type === typeSelect.value &&
    d.brand === brandSelect.value &&
    d.model === modelSelect.value
  );
  stepResult.innerHTML = matches.map(m => `
    <div class="card">
      <strong>Код:</strong> ${m.code}<br>
      <strong>Верига:</strong> ${m.chain}
    </div>
  `).join("");
});

codeInput.addEventListener("input", () => {
  const code = codeInput.value.trim();
  if (code.length !== 6) { codeResult.innerHTML = ""; return; }
  const match = data.find(d => d.code === code);
  if (!match) {
    codeResult.innerHTML = '<div class="card">Няма намерен резултат.</div>';
    return;
  }
  codeResult.innerHTML = `
    <div class="card">
      <strong>Марка:</strong> ${match.brand}<br>
      <strong>Модел:</strong> ${match.model}<br>
      <strong>Вид:</strong> ${match.type}<br>
      <strong>Верига:</strong> ${match.chain}
    </div>
  `;
});

function addOptions(select, values) {
  [...new Set(values)].forEach(v => {
    const o = document.createElement("option");
    o.value = v;
    o.textContent = v;
    select.appendChild(o);
  });
}
</script>

</body>
</html>
